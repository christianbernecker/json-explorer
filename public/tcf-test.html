<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TCF 2.0 CMP Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    button {
      background-color: #4285f4;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 0;
    }
    .test-indicator {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background: orange;
      padding: 5px;
      font-size: 10px;
      z-index: 9999;
    }
  </style>

  <!-- Klaro CMP Direct Integration -->
  <script>
    // TCF 2.0 Purposes definieren (IAB standard)
    const TCF_PURPOSES = {
      STORE_INFO: 1,           // Informationen auf dem Gerät speichern
      BASIC_ADS: 2,            // Grundlegende Anzeigen
      PERSONALIZED_PROFILE: 3, // Personalisiertes Profil erstellen
      PERSONALIZED_ADS: 4,     // Personalisierte Anzeigen auswählen
      CONTENT_PROFILE: 5,      // Inhaltsprofil erstellen
      PERSONALIZED_CONTENT: 6, // Personalisierte Inhalte auswählen
      AD_PERFORMANCE: 7,       // Anzeigenleistung messen
      CONTENT_PERFORMANCE: 8,  // Inhaltsleistung messen
      MARKET_RESEARCH: 9,      // Marktforschung
      IMPROVE_PRODUCTS: 10     // Produkte entwickeln und verbessern
    };
    
    // TCF 2.0 Special Features (opt-in erforderlich)
    const SPECIAL_FEATURES = {
      PRECISE_GEO: 1,          // Präzise Geolokalisierung
      DEVICE_CHARACTERISTICS: 2 // Aktives Scannen von Geräteeigenschaften
    };

    // Klaro-Konfiguration
    window.klaroConfig = {
      // Allgemeine Einstellungen
      elementID: 'klaro',
      storageMethod: 'localStorage',
      storageName: 'json-explorer-consent',
      htmlTexts: true,
      embedded: false,
      groupByPurpose: true,
      cookieExpiresAfterDays: 365,
      noAutoLoad: true, // Wir laden manuell für den Test
      testing: true,    // Immer im Test-Modus
      
      // Styling Einstellungen
      styling: {
        theme: ['light', 'top', 'wide'],
        additionalClass: 'json-explorer-cmp-modal',
      },
      
      // TCF 2.0 Integration
      tcf2: {
        enabled: true,
        scope: 'global',       // 'global' oder 'service-specific'
        contextualConsentOnly: false,
        
        // Default-Einstellungen für Purposes
        defaultConsents: {
          purposes: {
            [TCF_PURPOSES.STORE_INFO]: true,            // Essentiell für das Funktionieren
            [TCF_PURPOSES.BASIC_ADS]: false,            // Opt-in
            [TCF_PURPOSES.PERSONALIZED_PROFILE]: false, // Opt-in
            [TCF_PURPOSES.PERSONALIZED_ADS]: false,     // Opt-in
            [TCF_PURPOSES.CONTENT_PROFILE]: false,      // Opt-in
            [TCF_PURPOSES.PERSONALIZED_CONTENT]: false, // Opt-in
            [TCF_PURPOSES.AD_PERFORMANCE]: false,       // Opt-in
            [TCF_PURPOSES.CONTENT_PERFORMANCE]: false,  // Opt-in
            [TCF_PURPOSES.MARKET_RESEARCH]: false,      // Opt-in
            [TCF_PURPOSES.IMPROVE_PRODUCTS]: false,     // Opt-in
          }
        },
        
        // IAB TCF 2.0 CMP Einstellungen
        cmpId: 123,                   // Muss durch eine offizielle IAB CMP ID ersetzt werden
        cmpVersion: 1,
        vendorListUpdateFrequency: 7, // Wie oft die Vendor-Liste aktualisiert wird (in Tagen)
        publisherCountryCode: 'DE',   // Das Land des Publishers
        publisherName: 'JSON Explorer',
        
        // Vendor-Liste URL (offizielle IAB-Liste)
        vendorList: 'https://vendor-list.consensu.org/v2/vendor-list.json'
      },
      
      // Dienste (Services) Konfiguration
      services: [
        {
          name: 'analytics',
          title: 'Web Analytics',
          description: 'Wir verwenden Analytics-Tools, um zu verstehen, wie unsere Website genutzt wird und um sie zu verbessern.',
          purposes: [
            TCF_PURPOSES.STORE_INFO,
            TCF_PURPOSES.CONTENT_PERFORMANCE,
            TCF_PURPOSES.MARKET_RESEARCH,
            TCF_PURPOSES.IMPROVE_PRODUCTS
          ],
          required: false,
          default: false
        }
      ],
      
      // Übersetzungen für UI-Elemente
      translations: {
        en: {
          privacyPolicyUrl: '/json-explorer/legal/privacy',
          consentModal: {
            title: 'Privacy Preferences',
            description: 'Here you can assess and customize the services that we would like to use on this website. You are in charge! Enable or disable services as you see fit.',
          },
          purposes: {
            [TCF_PURPOSES.STORE_INFO]: 'Store information on your device',
            [TCF_PURPOSES.BASIC_ADS]: 'Basic ads',
            [TCF_PURPOSES.PERSONALIZED_PROFILE]: 'Create personalized ad profile',
            [TCF_PURPOSES.PERSONALIZED_ADS]: 'Select personalized ads',
            [TCF_PURPOSES.CONTENT_PROFILE]: 'Create personalized content profile',
            [TCF_PURPOSES.PERSONALIZED_CONTENT]: 'Select personalized content',
            [TCF_PURPOSES.AD_PERFORMANCE]: 'Measure ad performance',
            [TCF_PURPOSES.CONTENT_PERFORMANCE]: 'Measure content performance',
            [TCF_PURPOSES.MARKET_RESEARCH]: 'Market research',
            [TCF_PURPOSES.IMPROVE_PRODUCTS]: 'Develop and improve products',
          },
          ok: 'Accept',
          save: 'Save preferences',
          acceptAll: 'Accept all',
          acceptSelected: 'Accept selected',
          decline: 'Decline',
          close: 'Close',
        }
      }
    };
  </script>
  <script src="https://cdn.kiprotect.com/klaro/v0.7/klaro.js"></script>
</head>
<body>
  <div class="test-indicator">
    TCF 2.0 CMP Test v1.0
  </div>

  <h1>TCF 2.0 CMP Implementation Test</h1>
  <p>This page tests the TCF 2.0 compliant CMP implementation using Klaro. Click the button below to show the CMP modal:</p>
  
  <button onclick="window.klaro.show(window.klaroConfig)">Show Privacy Settings</button>
  
  <h2>CMP Status:</h2>
  <pre id="status">Checking CMP status...</pre>
  
  <script>
    // Display CMP status
    window.addEventListener('load', function() {
      const statusEl = document.getElementById('status');
      
      // Check if Klaro is available
      if (window.klaro) {
        statusEl.textContent = 'Klaro CMP loaded successfully. Click the button above to show the CMP.';
        
        // Check TCF API
        if (window.klaro.getManager()) {
          statusEl.textContent += '\n\nCMP Manager initialized.';
        } else {
          statusEl.textContent += '\n\nCMP Manager not available yet. Try clicking the button.';
        }
      } else {
        statusEl.textContent = 'ERROR: Klaro CMP not loaded!';
      }
    });
  </script>
</body>
</html> 